<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Interclasses</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap');
        :root {
            --cor-primaria: #0a2463; --cor-secundaria: #3e92cc; --cor-sucesso: #2a9d8f;
            --cor-aviso: #e76f51; --cor-fundo: #f0f4f8; --cor-texto: #333; --cor-branca: #ffffff;
            --sombra: 0 4px 15px rgba(0, 0, 0, 0.1); --cor-live: #d90429;
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideInUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        body { font-family: 'Poppins', sans-serif; background-color: var(--cor-fundo); margin: 0; padding: 20px; animation: fadeIn 0.5s ease-in-out; }
        .container { width: 100%; max-width: 1200px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 30px; }
        h1 { color: var(--cor-primaria); }
        .tabs { display: flex; justify-content: center; margin-bottom: 30px; }
        .tab-button { border: none; background: #fff; padding: 10px 25px; font-size: 1em; font-weight: 600; cursor: pointer; border-radius: 50px; transition: all 0.3s ease; color: var(--cor-secundaria); margin: 0 5px; box-shadow: var(--sombra); }
        .tab-button.active { background-color: var(--cor-secundaria); color: var(--cor-branca); }
        .view { display: none; }
        .view.active { display: block; animation: fadeIn 0.5s; }
        .organizer-container { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
        .calendar-column h2 { text-align: center; color: var(--cor-primaria); border-bottom: 2px solid var(--cor-secundaria); padding-bottom: 10px;}
        .card { background-color: var(--cor-branca); border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: var(--sombra); border-left: 5px solid var(--cor-secundaria); animation: slideInUp 0.5s ease-out; transition: all 0.3s ease; }
        .card:hover { transform: translateY(-5px); box-shadow: 0 8px 20px rgba(0,0,0,0.1); }
        .card h3 { margin-top: 0; }
        .card.live { border-left-color: var(--cor-live); box-shadow: 0 8px 25px rgba(217, 4, 41, 0.3); }
        .card.live h3::after { content: 'AO VIVO'; font-size: 0.7em; background: var(--cor-live); color: white; padding: 2px 6px; border-radius: 4px; margin-left: 10px; }
        .student-view-container { max-width: 800px; margin: 0 auto; }
        #student-selector { width: 100%; padding: 15px; font-size: 1.1em; border-radius: 10px; border: 2px solid #ddd; }
        #next-event-card { text-align: center; border-color: var(--cor-sucesso); animation: fadeIn 1s infinite alternate; }
        #student-calendar { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; }
        .student-day-col h3 { text-align: center; color: var(--cor-primaria); }
        .student-event { background: #fff; padding: 10px; border-radius: 8px; margin-bottom: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .status-jogo { border-left: 4px solid var(--cor-sucesso); }
        .status-vendas { border-left: 4px solid var(--cor-aviso); }
        .loading-message { text-align: center; font-size: 1.2em; color: #888; padding: 50px; }
        .hidden { display: none; }
        @media (max-width: 900px) { .organizer-container { grid-template-columns: 1fr; } }
        @media (max-width: 600px) { #student-calendar { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="container">
        <header><h1>Painel dos Jogos Interclasses</h1></header>
        <div class="tabs">
            <button class="tab-button active" id="btn-organizador">Visão do Organizador</button>
            <button class="tab-button" id="btn-estudante">Visão do Estudante</button>
        </div>

        <div id="view-organizador" class="view active">
            <div class="organizer-container">
                <div class="calendar-column" id="games-calendar"><h2>Calendário de Jogos</h2><div class="loading-message">Carregando...</div></div>
                <div class="calendar-column" id="sales-calendar"><h2>Equipe de Vendas</h2><div class="loading-message">Carregando...</div></div>
            </div>
        </div>

        <div id="view-estudante" class="view">
            <div class="student-view-container">
                <select id="student-selector"><option value="">-- Selecione seu nome --</option></select>
                <div id="next-event-card" class="card hidden"></div>
                <div id="student-calendar" class="hidden">
                    <div class="student-day-col" id="student-tuesday"><h3>Terça (12/08)</h3></div>
                    <div class="student-day-col" id="student-wednesday"><h3>Quarta (13/08)</h3></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const URL_DA_API = 'https://script.google.com/macros/s/AKfycbyfE-FdwDMqORhsU8rA0cO1lic06TBNf6y-5AZOFDEDqxPhOrybMtTfQiuw_vWw9WkJMA/exec';

        document.addEventListener('DOMContentLoaded', () => {
            const views = {
                organizador: document.getElementById('view-organizador'),
                estudante: document.getElementById('view-estudante'),
            };
            const buttons = {
                organizador: document.getElementById('btn-organizador'),
                estudante: document.getElementById('btn-estudante'),
            };
            const gamesContainer = document.getElementById('games-calendar');
            const salesContainer = document.getElementById('sales-calendar');
            const studentSelector = document.getElementById('student-selector');
            const nextEventCard = document.getElementById('next-event-card');
            const studentCalendar = document.getElementById('student-calendar');

            let appData = {};

            const switchView = (viewName) => {
                Object.values(views).forEach(v => v.classList.remove('active'));
                Object.values(buttons).forEach(b => b.classList.remove('active'));
                views[viewName].classList.add('active');
                buttons[viewName].classList.add('active');
            };

            buttons.organizador.addEventListener('click', () => switchView('organizador'));
            buttons.estudante.addEventListener('click', () => switchView('estudante'));

            async function fetchData() {
                try {
                    const response = await fetch(URL_DA_API);
                    if (!response.ok) throw new Error(`Erro na rede: ${response.status}`);
                    appData = await response.json();
                    if (appData.error) throw new Error(`Erro no Backend: ${appData.error}`);
                    
                    renderOrganizerView();
                    populateStudentDropdown();
                    setInterval(updateLiveIndicator, 60000); // Atualiza a cada minuto
                } catch (error) {
                    console.error('Falha ao carregar dados:', error);
                    gamesContainer.innerHTML = `<p class="loading-message" style="color:red;">Falha ao carregar dados. Verifique a API e as permissões.</p>`;
                    salesContainer.innerHTML = '';
                }
            }

            function renderOrganizerView() {
                // Renderiza Calendário de Jogos
                let gamesHtml = '<h2>Calendário de Jogos</h2>';
                if (!appData.jogos || appData.jogos.length === 0) {
                    gamesHtml += '<p>Nenhum jogo agendado.</p>';
                } else {
                    appData.jogos.forEach(jogo => {
                        gamesHtml += `
                            <div class="card" data-dia="${jogo.dia}" data-horario="${jogo.horario}">
                                <h3>${jogo.horario} - ${jogo.nomeCompleto.split(' (')[0]}</h3>
                                <p><strong>Jogadores:</strong> ${jogo.inscritos.join(', ')}</p>
                            </div>
                        `;
                    });
                }
                gamesContainer.innerHTML = gamesHtml;
                updateLiveIndicator();

                // Renderiza Equipe de Vendas
                let salesHtml = '<h2>Equipe de Vendas</h2>';
                if (!appData.vendas || appData.vendas.length === 0) {
                    salesHtml += '<p>Nenhuma equipe de vendas definida.</p>';
                } else {
                    appData.vendas.forEach(venda => {
                        salesHtml += `
                            <div class="card">
                                <h3>${venda.periodo}</h3>
                                <p><strong>Equipe:</strong> ${venda.equipe.join(', ')}</p>
                            </div>
                        `;
                    });
                }
                salesContainer.innerHTML = salesHtml;
            }

            function updateLiveIndicator() {
                const agora = new Date();
                const cards = document.querySelectorAll('#games-calendar .card');
                let proximoJogoCard = null;

                cards.forEach(card => card.classList.remove('live'));

                for (const card of cards) {
                    const [h, m] = card.dataset.horario.split(':');
                    const diaParts = card.dataset.dia.split('/');
                    const dataJogo = new Date(2025, parseInt(diaParts[1]) - 1, parseInt(diaParts[0]), h, m);
                    
                    if (dataJogo > agora) {
                        proximoJogoCard = card;
                        break;
                    }
                }
                if (proximoJogoCard) {
                    proximoJogoCard.classList.add('live');
                }
            }

            function populateStudentDropdown() {
                if (!appData.cronogramasEstudantes) return;
                appData.cronogramasEstudantes.forEach(est => {
                    const option = document.createElement('option');
                    option.value = est.nome;
                    option.textContent = est.nome;
                    studentSelector.appendChild(option);
                });
            }

            studentSelector.addEventListener('change', (e) => {
                const nomeAluno = e.target.value;
                if (nomeAluno) {
                    renderStudentDetail(nomeAluno);
                } else {
                    nextEventCard.classList.add('hidden');
                    studentCalendar.classList.add('hidden');
                }
            });

            function renderStudentDetail(nomeAluno) {
                const aluno = appData.cronogramasEstudantes.find(e => e.nome === nomeAluno);
                if (!aluno) return;
                
                const agora = new Date();
                let proximoEvento = null;
                
                // Ordena eventos para encontrar o próximo
                const eventosOrdenados = aluno.eventos.map(evt => {
                    let dataEvento;
                    if(evt.tipo === 'jogo') {
                        const [h, m] = evt.horario.split(':');
                        const diaParts = evt.dia.split('/');
                         dataEvento = new Date(2025, parseInt(diaParts[1]) - 1, parseInt(diaParts[0]), h, m);
                    } else { // Vendas
                         const diaParts = evt.dia.split('/');
                         const hora = evt.turno === 'Manhã' ? 8 : 13; // Hora representativa
                         dataEvento = new Date(2025, parseInt(diaParts[1]) - 1, parseInt(diaParts[0]), hora, 0);
                    }
                    return {...evt, dataObj: dataEvento};
                }).sort((a,b) => a.dataObj - b.dataObj);

                proximoEvento = eventosOrdenados.find(evt => evt.dataObj > agora);

                // Renderiza card do próximo evento
                if (proximoEvento) {
                    nextEventCard.innerHTML = `<h3>Seu Próximo Evento</h3><p style="font-size:1.2em; font-weight:600;">${proximoEvento.nome} às ${proximoEvento.horario || proximoEvento.periodo}</p>`;
                    nextEventCard.classList.remove('hidden');
                } else {
                    nextEventCard.innerHTML = `<h3>Participação Encerrada</h3><p>Obrigado por participar dos jogos!</p>`;
                    nextEventCard.classList.remove('hidden');
                }

                // Renderiza calendário completo do aluno
                const tercaCol = document.getElementById('student-tuesday');
                const quartaCol = document.getElementById('student-wednesday');
                tercaCol.innerHTML = '<h3>Terça (12/08)</h3>'; 
                quartaCol.innerHTML = '<h3>Quarta (13/08)</h3>';

                if(aluno.eventos.length === 0){
                    tercaCol.innerHTML += '<p>Nenhum evento agendado.</p>';
                    quartaCol.innerHTML += '<p>Nenhum evento agendado.</p>';
                } else {
                     aluno.eventos.forEach(evt => {
                        const eventoHtml = `<div class="student-event ${evt.tipo === 'jogo' ? 'status-jogo' : 'status-vendas'}"><strong>${evt.horario || evt.turno}:</strong> ${evt.nome}</div>`;
                        if (evt.dia === '12/08') tercaCol.innerHTML += eventoHtml;
                        if (evt.dia === '13/08') quartaCol.innerHTML += eventoHtml;
                    });
                }
                studentCalendar.classList.remove('hidden');
            }

            fetchData();
        });
    </script>
</body>
</html>

